# Locators to Mark Parts

## Problem Context

Users need to mark song sections (intro, verse, chorus, bridge, etc.) to navigate long transcriptions efficiently. Without locators, users must remember beat positions or rely on waveform visual landmarks.

**User workflow (from PRD):**

- Mark song sections with locators
- Navigate to locators during transcription/editing

## Approach

Implement a minimal locator system with:

1. **Data model** - Locator type with beat position and label
2. **Timeline rendering** - Visual markers on timeline bar
3. **User interaction** - Double-click timeline to add, click to navigate, delete via keyboard
4. **Persistence** - Save/restore with project

### Design Decisions

**Visual representation:**

- Small colored triangle/flag marker at beat position on timeline
- Label displayed on hover or always visible if space permits
- Similar to DAW section markers (Ableton Live, Logic Pro)

**Interaction:**

- Double-click empty timeline area → create locator at that position
- Click locator → seek playhead to that position
- Select locator + Delete → remove locator
- Right-click or keyboard shortcut to edit label (future enhancement)

**Data structure:**

```typescript
interface Locator {
  id: string;
  beat: number;
  label: string;
}
```

**Placement in UI:**

- Render as absolute-positioned elements in Timeline component
- Above timeline bar numbers, at same horizontal position as beat

## Reference Files/Patterns

- **Types**: `src/types.ts` - Add Locator interface
- **Store**: `src/stores/project-store.ts` - Add locators array, CRUD actions, persistence
- **Timeline**: `src/components/piano-roll.tsx` Timeline function - Render markers, handle interactions
- **Similar pattern**: Timeline playhead indicator (lines 1099-1105)

## Implementation Steps

1. **Add Locator type** to `src/types.ts`
2. **Update project store** (`src/stores/project-store.ts`):
   - Add `locators: Locator[]` to state
   - Add actions: `addLocator`, `updateLocator`, `deleteLocator`, `selectedLocatorId`
   - Add to persistence (SavedProject interface, save/load)
3. **Update Timeline component** (`src/components/piano-roll.tsx`):
   - Add locator markers rendering
   - Handle double-click to create locator
   - Handle click to seek + select
   - Handle delete key for selected locator
4. **Add E2E test** (optional, based on time):
   - Create locator via double-click
   - Verify locator persists
   - Navigate to locator
   - Delete locator

## Testing Strategy

**Manual testing:**

- Create locator at different zoom levels
- Navigate to locators
- Delete locators
- Save/load project with locators
- Edge cases: locators at same position, locators beyond visible area

**E2E test (if time permits):**

- Basic locator lifecycle (create, navigate, persist, delete)

## Status

### Completed

- [x] Add Locator type to types.ts
- [x] Update project store with locator state and actions
- [x] Add locator persistence
- [x] Render locators on timeline
- [x] Handle double-click to create
- [x] Handle click to navigate
- [x] Handle delete key
- [x] E2E tests (5 tests covering all features)
- [x] Manual testing
- [x] Update PRD checklist

### Implementation Summary

Successfully implemented locators for marking song sections:

**Visual Design:**

- Amber triangle markers on timeline
- Labels shown on hover or when selected
- Selected state with brighter color

**Interactions:**

- Double-click timeline → creates locator at that beat position
- Click locator → seeks playhead to that position and selects it
- Delete/Backspace key → removes selected locator
- Auto-sorted by beat position

**Persistence:**

- Locators saved/loaded with project
- Backwards compatible (optional field in SavedProject)

**Testing:**

- 5 E2E tests covering all functionality
- All tests passing

### Screenshots

- https://github.com/user-attachments/assets/8ee509fc-c5da-450d-8a17-d197ad927076
- https://github.com/user-attachments/assets/13e621cb-5393-469d-b30f-85536a2e4d3e

### Remaining

- None

### Blockers/Notes

- None
